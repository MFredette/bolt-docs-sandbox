<?xml version="1.0" encoding="UTF-8"?><?path2rootmap-uri ./?>
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="plan-execution-functions-and-standard-libraries"><title>Plan execution functions and standard libraries</title><prolog><author>Jean Bond &lt;jean@puppet.com\&gt;</author></prolog><body><p>Your plan can execute multiple functions on remote systems.</p><p>Your plan can include functions to run commands, scripts, tasks, and other plans on remote nodes. These execution functions correspond to task runner commands.</p><p><b>Note:</b> All the $nodes arguments support the patterns supported by --nodes \(except for shell expansion\).</p></body><topic id="bolt-functions"><title>Bolt functions</title><body/><topic id="add-facts"><title>add\_facts</title><body><p>Deep merges a hash of facts with the existing facts on a target.</p><p><b>Note:</b> Not available in apply block.</p><codeblock xml:space="preserve">add_facts(Target $target, Hash $facts)</codeblock><p><i>Returns:</i><codeph>Hash[String, Data]</codeph> The target's new facts.</p><ul><li><p><b>target</b><codeph>Target</codeph> A target.</p></li><li><p><b>facts</b><codeph>Hash</codeph> A hash of fact names to values that may include structured facts.</p></li></ul><p><b>Example:</b> Adding facts to a target</p><codeblock xml:space="preserve">add_facts($target, { 'os' =&gt; { 'family' =&gt; 'windows', 'name' =&gt; 'windows' } })</codeblock></body></topic><topic id="add-to-group"><title>add\_to\_group</title><body><p>Adds a target to specified inventory group.</p><p><b>Note:</b> Not available in apply block.</p><codeblock xml:space="preserve">add_to_group(Boltlib::TargetSpec $targets, String[1] $group)</codeblock><p><i>Returns:</i> <codeph>Any</codeph></p><ul><li><p><b>targets</b><codeph>Boltlib::TargetSpec</codeph> A pattern or array of patterns identifying a set of targets.</p></li><li><p><b>group</b><codeph>String[1]</codeph> The name of the group to add targets to.</p></li></ul><p><b>Example:</b> Add new target to group.</p><codeblock xml:space="preserve">Target.new('foo@example.com', 'password' =&gt; 'secret').add_to_group('group1')</codeblock><p><b>Example:</b> Add new target to group by name.</p><codeblock xml:space="preserve">add_to_group('bolt:bolt@web.com', 'group1')</codeblock><p><b>Example:</b> Add an array of targets to group by name.</p><codeblock xml:space="preserve">add_to_group(['host1', 'group1', 'winrm://host2:54321'], 'group1')</codeblock><p><b>Example:</b> Add a comma-separated list list of targets to group by name.</p><codeblock xml:space="preserve">add_to_group('foo,bar,baz', 'group1')</codeblock></body></topic><topic id="apply-prep"><title>apply\_prep</title><body><p>Installs the puppet-agent package on targets, if needed, then collects facts, including any custom facts found in the Bolt modulepath.</p><p>Agent detection is skipped if the target includes the <codeph>puppet-agent</codeph> feature, either as a property of its transport \(PCP\) or by explicitly setting it as a feature in the Bolt inventory.</p><p>If no agent is detected on the target using the <codeph>puppet_agent::version</codeph> task, it's installed using <codeph>puppet_agent::install</codeph> and the puppet service is stopped/disabled using the <codeph>service</codeph> task.</p><p><b>Note:</b> Not available in apply block.</p><codeblock xml:space="preserve">apply_prep(Boltlib::TargetSpec $targets)</codeblock><p><i>Returns:</i> <codeph>Any</codeph></p><ul><li><p><b>targets</b><codeph>Boltlib::TargetSpec</codeph> A pattern or array of patterns identifying a set of targets.</p></li></ul><p><b>Example:</b> Prepare targets by name.</p><codeblock xml:space="preserve">apply_prep('target1,target2')</codeblock></body></topic><topic id="catch-errors"><title>catch\_errors</title><body><p>Catches errors in a given block and returns them, or returns the output of the block if no errors are raised. Accepts an optional list of error kinds to catch.</p><p><b>Note:</b> Not available in apply block.</p><codeblock xml:space="preserve">catch_errors(Optional[Array[String[1]]] $error_types, Callable[0, 0] &amp;$block)</codeblock><p><i>Returns:</i> <codeph>Undef</codeph> If an error is raised in the block, then the error is returned, otherwise the result is returned.</p><ul><li><p><b>error\_types</b><codeph>Optional[Array[String[1]]]</codeph> An array of error types to catch.</p></li><li><p><b>&amp;block</b><codeph>Callable[0, 0]</codeph> The block of steps to catch errors on.</p></li></ul><p><b>Example:</b> Catch errors for a block.</p><codeblock xml:space="preserve">catch_errors() || {
  run_command("whoami", $nodes)
  run_command("adduser ryan", $nodes)
}</codeblock><p><b>Example:</b> Catch parse errors for a block of code.</p><codeblock xml:space="preserve">catch_errors(['bolt/parse-error']) || {
 run_plan('canary', $nodes)
 run_plan('other_plan)
 apply($nodes) || {
   notify { "Hello": }
 }
}</codeblock></body></topic><topic id="ctrldo-until"><title>ctrl::do\_until</title><body><p>Repeat the block until it returns a truthy value. Returns the value.</p><codeblock xml:space="preserve">ctrl::do_until(Callable &amp;$block)</codeblock><p><i>Returns:</i> <codeph>Any</codeph></p><ul><li><p><b>block</b> <codeph>Callable</codeph></p></li></ul><p><b>Example:</b> Run a task until it succeeds</p><codeblock xml:space="preserve">ctrl::do_until() || {
  run_task('test', $target, _catch_errors =&gt; true).ok?
}</codeblock></body></topic><topic id="ctrlsleep"><title>ctrl::sleep</title><body><p>Sleeps for specified number of seconds.</p><codeblock xml:space="preserve">ctrl::sleep(Numeric $period)</codeblock><p><i>Returns:</i> <codeph>Undef</codeph></p><ul><li><p><b>period</b><codeph>Numeric</codeph> time to sleep \(in seconds\)</p></li></ul><p><b>Example:</b> Sleep for 5 seconds</p><codeblock xml:space="preserve">ctrl::sleep(5)</codeblock></body></topic><topic id="facts"><title>facts</title><body><p>Returns the facts hash for a target.</p><codeblock xml:space="preserve">facts(Target $target)</codeblock><p><i>Returns:</i><codeph>Hash[String, Data]</codeph> The target's facts.</p><ul><li><p><b>target</b><codeph>Target</codeph> A target.</p></li></ul><p><b>Example:</b> Getting facts</p><codeblock xml:space="preserve">facts($target)</codeblock></body></topic><topic id="fail-plan"><title>fail\_plan</title><body><p>Raises a Bolt::PlanFailure exception to signal to callers that the plan failed.</p><p>Plan authors should call this function when their plan is not successful. The error may then be caught by another plans run\_plan function or in bolt itself.</p><p><b>Note:</b> Not available in apply block.</p></body><topic id="fail-a-plan-generating-an-exception-from-the-parameters"><title>Fail a plan, generating an exception from the parameters.</title><body><codeblock xml:space="preserve">fail_plan(String[1] $msg, Optional[String[1]] $kind, Optional[Hash[String[1], Any]] $details, Optional[String[1]] $issue_code)</codeblock><p><i>Returns:</i><codeph>Any</codeph> Raises an exception.</p><ul><li><p><b>msg</b><codeph>String[1]</codeph> An error message.</p></li><li><p><b>kind</b><codeph>Optional[String[1]]</codeph> An easily matchable error kind.</p></li><li><p><b>details</b><codeph>Optional[Hash[String[1], Any]]</codeph> Machine-parseable details about the error.</p></li><li><p><b>issue\_code</b><codeph>Optional[String[1]]</codeph> Unused.</p></li></ul><p><b>Example:</b> Raise an exception</p><codeblock xml:space="preserve">fail_plan('We goofed up', 'task-unexpected-result', { 'result' =&gt; 'null' })</codeblock></body></topic><topic id="fail-a-plan-generating-an-exception-from-an-existing-error-object"><title>Fail a plan, generating an exception from an existing Error object.</title><body><codeblock xml:space="preserve">fail_plan(Error $error)</codeblock><p><i>Returns:</i><codeph>Any</codeph> Raises an exception.</p><ul><li><p><b>error</b><codeph>Error</codeph> An error object.</p></li></ul><p><b>Example:</b> Raise an exception</p><codeblock xml:space="preserve">fail_plan(Error('We goofed up', 'task-unexpected-result', { 'result' =&gt; 'null' }))</codeblock></body></topic></topic><topic id="fileexists"><title>file::exists</title><body><p>Check if a file exists.</p><codeblock xml:space="preserve">file::exists(String $filename)</codeblock><p><i>Returns:</i> <codeph>Boolean</codeph></p><ul><li><p><b>filename</b><codeph>String</codeph> Absolute path or Puppet file path.</p></li></ul><p><b>Example:</b> Check a file on disk</p><codeblock xml:space="preserve">file::exists('/tmp/i_dumped_this_here')</codeblock><p><b>Example:</b> Check a file from the modulepath</p><codeblock xml:space="preserve">file::exists('example/files/VERSION')</codeblock></body></topic><topic id="fileread"><title>file::read</title><body><p>Read a file and return its contents.</p><codeblock xml:space="preserve">file::read(String $filename)</codeblock><p><i>Returns:</i> <codeph>String</codeph></p><ul><li><p><b>filename</b><codeph>String</codeph> Absolute path or Puppet file path.</p></li></ul><p><b>Example:</b> Read a file from disk</p><codeblock xml:space="preserve">file::read('/tmp/i_dumped_this_here')</codeblock><p><b>Example:</b> Read a file from the modulepath</p><codeblock xml:space="preserve">file::read('example/files/VERSION')</codeblock></body></topic><topic id="filereadable"><title>file::readable</title><body><p>Check if a file is readable.</p><codeblock xml:space="preserve">
file::readable(String $filename)</codeblock><p><i>Returns:</i> <codeph>Boolean</codeph></p><ul><li><p><b>filename</b><codeph>String</codeph> Absolute path or Puppet file path.</p></li></ul><p><b>Example:</b> Check a file on disk</p><codeblock xml:space="preserve">file::readable('/tmp/i_dumped_this_here')</codeblock><p><b>Example:</b> Check a file from the modulepath</p><codeblock xml:space="preserve">file::readable('example/files/VERSION')</codeblock></body></topic><topic id="filewrite"><title>file::write</title><body><p>Write a string to a file.</p><codeblock xml:space="preserve">file::write(String $filename, String $content)</codeblock><p><i>Returns:</i> <codeph>Undef</codeph></p><ul><li><p><b>filename</b><codeph>String</codeph> Absolute path.</p></li><li><p><b>content</b><codeph>String</codeph> File content to write.</p></li></ul><p><b>Example:</b> Write a file to disk</p><codeblock xml:space="preserve">file::write('C:/Users/me/report', $apply_result.first.report)</codeblock></body></topic><topic id="get-resources"><title>get\_resources</title><body><p>Query the state of resources on a list of targets using resource definitions in the Bolt module path. The results are returned as a list of hashes representing each resource.</p><p>The Puppet agent must be installed on the target. You can install the agent with the<codeph>apply_prep</codeph> function or by directly running the <codeph>puppet_agent::install</codeph> task.</p><p><b>Note:</b> Not available in apply block.</p><codeblock xml:space="preserve">get_resources(Boltlib::TargetSpec $targets, Variant[String, Resource, Array[Variant[String, Resource]]] $resources)</codeblock><p><i>Returns:</i> <codeph>Any</codeph></p><ul><li><p><b>targets</b><codeph>Boltlib::TargetSpec</codeph> A pattern or array of patterns identifying a set of targets.</p></li><li><p><b>resources</b><codeph>Variant[String, Resource, Array[Variant[String, Resource]]]</codeph> A resource type or instance, or an array of such.</p></li></ul><p><b>Example:</b> Collect resource states for packages and a file</p><codeblock xml:space="preserve">get_resources('target1,target2', [Package, File[/etc/puppetlabs]])</codeblock></body></topic><topic id="get-targets"><title>get\_targets</title><body><p>Parses common ways of referring to targets and returns an array of Targets.</p><codeblock xml:space="preserve">get_targets(Boltlib::TargetSpec $names)</codeblock><p><i>Returns:</i><codeph>Array[Target]</codeph> A list of unique Targets resolved from any target URIs and groups.</p><ul><li><p><b>names</b><codeph>Boltlib::TargetSpec</codeph> A pattern or array of patterns identifying a set of targets.</p></li></ul><p><b>Example:</b> Resolve a group</p><codeblock xml:space="preserve">get_targets('group1')</codeblock><p><b>Example:</b> Resolve a target URI</p><codeblock xml:space="preserve">get_targets('winrm://host2:54321')</codeblock><p><b>Example:</b> Resolve array of groups and/or target URIs</p><codeblock xml:space="preserve">get_targets(['host1', 'group1', 'winrm://host2:54321'])</codeblock><p><b>Example:</b> Resolve string consisting of a comma-separated list of groups and/or target URIs</p><codeblock xml:space="preserve">get_targets('host1,group1,winrm://host2:54321')</codeblock><p><b>Example:</b> Run on localhost</p><codeblock xml:space="preserve">get_targets('localhost')</codeblock></body></topic><topic id="outmessage"><title>out::message</title><body><p>Output a message for the user.</p><p>This will print a message to stdout when using the human output format.</p><p><b>Note:</b> Not available in apply block.</p><codeblock xml:space="preserve">out::message(String $message)</codeblock><p><i>Returns:</i><codeph>Undef</codeph></p><ul><li><p><b>message</b><codeph>String</codeph> The message to output.</p></li></ul><p><b>Example:</b> Print a message</p><codeblock xml:space="preserve">out::message('Something went wrong')</codeblock></body></topic><topic id="puppetdb-fact"><title>puppetdb\_fact</title><body><p>Collects facts based on a list of certnames.</p><ul><li><p>If a node is not found in PuppetDB, it's included in the returned hash with empty facts hash.</p></li><li><p>Otherwise the node is included in the hash with a value that is a hash of it's facts.</p></li></ul><codeblock xml:space="preserve">puppetdb_fact(Array[String] $certnames)</codeblock><p><i>Returns:</i><codeph>Hash[String, Data]</codeph> A hash of certname to facts hash for each matched Target.</p><ul><li><p><b>certnames</b><codeph>Array[String]</codeph> Array of certnames.</p></li></ul><p><b>Example:</b> Get facts for nodes</p><codeblock xml:space="preserve">puppetdb_fact(['app.example.com', 'db.example.com'])</codeblock></body></topic><topic id="puppetdb-query"><title>puppetdb\_query</title><body><p>Makes a query to PuppetDB using Bolt's PuppetDB client.</p><codeblock xml:space="preserve">puppetdb_query(Variant[String, Array[Data]] $query)</codeblock><p><i>Returns:</i><codeph>Array[Data]</codeph> Results of the PuppetDB query.</p><ul><li><p><b>query</b><codeph>Variant[String, Array[Data]]</codeph> A PQL query.</p></li></ul><p><b>Example:</b> Request certnames for all nodes</p><codeblock xml:space="preserve">puppetdb_query('nodes[certname] {}')</codeblock><p><b>Related information</b></p><p><xref href="https://puppet.com/docs/puppetdb/latest/index.html" format="html" scope="external">PuppetDB</xref></p><p><xref href="https://puppet.com/docs/puppetdb/latest/api/query/tutorial-pql.html" format="html" scope="external">Puppet Query Language</xref></p></body></topic><topic id="run-command"><title>run\_command</title><body><p>Runs a command on the given set of targets and returns the result from each command execution. This function does nothing if the list of targets is empty.</p><p><b>Note:</b> Not available in apply block.</p></body><topic id="run-a-command"><title>Run a command.</title><body><codeblock xml:space="preserve">run_command(String[1] $command, Boltlib::TargetSpec $targets, Optional[Hash[String[1], Any]] $options)</codeblock><p><i>Returns:</i><codeph>ResultSet</codeph> A list of results, one entry per target.</p><ul><li><p><b>command</b><codeph>String[1]</codeph> A command to run on target.</p></li><li><p><b>targets</b><codeph>Boltlib::TargetSpec</codeph> A pattern identifying zero or more targets. See <codeph>get_targets</codeph> for accepted patterns.</p></li><li><p><b>options</b><codeph>Optional[Hash[String[1], Any]]</codeph> Additional options: '\_catch\_errors', '\_run\_as'.</p></li></ul><p><b>Example:</b> Run a command on targets</p><codeblock xml:space="preserve">run_command('hostname', $targets, '_catch_errors' =&gt; true)</codeblock></body></topic><topic id="run-a-command-logging-the-provided-description"><title>Run a command, logging the provided description.</title><body><codeblock xml:space="preserve">run_command(String[1] $command, Boltlib::TargetSpec $targets, String $description, Optional[Hash[String[1], Any]] $options)</codeblock><p><i>Returns:</i><codeph>ResultSet</codeph> A list of results, one entry per target.</p><ul><li><p><b>command</b><codeph>String[1]</codeph> A command to run on target.</p></li><li><p><b>targets</b><codeph>Boltlib::TargetSpec</codeph> A pattern identifying zero or more targets. See <codeph>get_targets</codeph>for accepted patterns.</p></li><li><p><b>description</b><codeph>String</codeph> A description to be output when calling this function.</p></li><li><p><b>options</b><codeph>Optional[Hash[String[1], Any]]</codeph> Additional options: '\_catch\_errors', '\_run\_as'.</p></li></ul><p><b>Example:</b> Run a command on targets</p><codeblock xml:space="preserve">run_command('hostname', $targets, '_catch_errors' =&gt; true)</codeblock></body></topic></topic><topic id="run-plan"><title>run\_plan</title><body><p>Runs the <codeph>plan</codeph> referenced by its name. A plan is autoloaded from <codeph>&lt;moduleroot&gt;/plans</codeph>.</p><p><b>Note:</b> Not available in apply block.</p></body><topic id="run-a-plan"><title>Run a plan.</title><body><codeblock xml:space="preserve">run_plan(String $plan_name, Optional[Hash] $named_args)</codeblock><p><i>Returns:</i><codeph>Boltlib::PlanResult</codeph> The result of running the plan. Undef if plan does not explicitly return results.</p><ul><li><p><b>plan\_name</b><codeph>String</codeph> The plan to run.</p></li><li><p><b>named\_args</b><codeph>Optional[Hash]</codeph> Arguments to the plan. Can also include additional options: '\_catch\_errors', '\_run\_as'.</p></li></ul><p><b>Example:</b> Run a plan</p><codeblock xml:space="preserve">run_plan('canary', 'command' =&gt; 'false', 'nodes' =&gt; $targets, '_catch_errors' =&gt; true)</codeblock></body></topic><topic id="run-a-plan-specifying-nodes-as-a-positional-argument"><title>Run a plan, specifying $nodes as a positional argument.</title><body><codeblock xml:space="preserve">run_plan(String $plan_name, Boltlib::TargetSpec $targets, Optional[Hash] $named_args)</codeblock><p><i>Returns:</i><codeph>Boltlib::PlanResult</codeph> The result of running the plan. Undef if plan does not explicitly return results.</p><ul><li><p><b>plan\_name</b><codeph>String</codeph> The plan to run.</p></li><li><p><b>named\_args</b><codeph>Optional[Hash]</codeph> Arguments to the plan. Can also include additional options: '\_catch\_errors', '\_run\_as'.</p></li><li><p><b>targets</b><codeph>Boltlib::TargetSpec</codeph> A pattern identifying zero or more targets. See the get\_targets function for accepted patterns.</p></li></ul><p><b>Example:</b> Run a plan</p><codeblock xml:space="preserve">run_plan('canary', '$nodes', 'command' =&gt; 'false')</codeblock></body></topic></topic><topic id="run-script"><title>run\_script</title><body><p>Uploads the given script to the given set of targets and returns the result of having each target execute the script. This function does nothing if the list of targets is empty.</p><p><b>Note:</b> Not available in apply block.</p></body><topic id="run-a-script"><title>Run a script.</title><body><codeblock xml:space="preserve">run_script(String[1] $script, Boltlib::TargetSpec $targets, Optional[Hash[String[1], Any]] $options)</codeblock><p><i>Returns:</i><codeph>ResultSet</codeph> A list of results, one entry per target.</p><ul><li><p><b>script</b><codeph>String[1]</codeph> Path to a script to run on target. May be an absolute path or a modulename/filename selector for a file in &lt;moduleroot\&gt;/files.</p></li><li><p><b>targets</b><codeph>Boltlib::TargetSpec</codeph> A pattern identifying zero or more targets. See for accepted patterns.</p></li><li><p><b>options</b><codeph>Optional[Hash[String[1], Any]]</codeph> Specify an array of arguments to the 'arguments' key to be passed to the script. Additional options: '\_catch\_errors', '\_run\_as'.</p></li></ul><p><b>Example:</b> Run a local script on Linux targets as 'root'</p><codeblock xml:space="preserve">run_script('/var/tmp/myscript', $targets, '_run_as' =&gt; 'root')</codeblock><p><b>Example:</b> Run a module-provided script with arguments</p><codeblock xml:space="preserve">run_script('iis/setup.ps1', $target, 'arguments' =&gt; ['/u', 'Administrator'])</codeblock></body></topic><topic id="run-a-script-logging-the-provided-description"><title>Run a script, logging the provided description.</title><body><codeblock xml:space="preserve">run_script(String[1] $script, Boltlib::TargetSpec $targets, String $description, Optional[Hash[String[1], Any]] $options)</codeblock><p><i>Returns:</i><codeph>ResultSet</codeph> A list of results, one entry per target.</p><ul><li><p><b>script</b><codeph>String[1]</codeph> Path to a script to run on target. May be an absolute path or a modulename/filename selector for a file in &lt;moduleroot\&gt;/files.</p></li><li><p><b>targets</b><codeph>Boltlib::TargetSpec</codeph> A pattern identifying zero or more targets.   for accepted patterns.</p></li><li><p><b>description</b><codeph>String</codeph> A description to be output when calling this function.</p></li><li><p><b>options</b><codeph>Optional[Hash[String[1], Any]]</codeph> Specify an array of arguments to the 'arguments' key to be passed to the script. Additional options: '\_catch\_errors', '\_run\_as'.</p></li></ul><p><b>Example:</b> Run a script</p><codeblock xml:space="preserve">run_script('/var/tmp/myscript', $targets, 'Downloading my application')</codeblock></body></topic></topic><topic id="run-task"><title>run\_task</title><body><p>Runs a given instance of a <codeph>Task</codeph> on the given set of targets and returns the result from each. This function does nothing if the list of targets is empty.</p><p><b>Note:</b> Not available in apply block.</p></body><topic id="run-a-task"><title>Run a task.</title><body><codeblock xml:space="preserve">run_task(String[1] $task_name, Boltlib::TargetSpec $targets, Optional[Hash[String[1], Any]] $task_args)</codeblock><p><i>Returns:</i><codeph>ResultSet</codeph> A list of results, one entry per target.</p><ul><li><p><b>task\_name</b><codeph>String[1]</codeph> The task to run.</p></li><li><p><b>targets</b><codeph>Boltlib::TargetSpec</codeph> A pattern identifying zero or more targets.   for accepted patterns.</p></li><li><p><b>task\_args</b><codeph>Optional[Hash[String[1], Any]]</codeph> Arguments to the plan. Can also include additional options: '\_catch\_errors', '\_run\_as'.</p></li></ul><p><b>Example:</b> Run a task as root</p><codeblock xml:space="preserve">run_task('facts', $targets, '_run_as' =&gt; 'root')</codeblock></body></topic><topic id="run-a-task-logging-the-provided-description"><title>Run a task, logging the provided description.</title><body><codeblock xml:space="preserve">run_task(String[1] $task_name, Boltlib::TargetSpec $targets, Optional[String] $description, Optional[Hash[String[1], Any]] $task_args)</codeblock><p><i>Returns:</i><codeph>ResultSet</codeph> A list of results, one entry per target.</p><ul><li><p><b>task\_name</b><codeph>String[1]</codeph> The task to run.</p></li><li><p><b>targets</b><codeph>Boltlib::TargetSpec</codeph> A pattern identifying zero or more targets.   for accepted patterns.</p></li><li><p><b>description</b><codeph>Optional[String]</codeph> A description to be output when calling this function.</p></li><li><p><b>task\_args</b><codeph>Optional[Hash[String[1], Any]]</codeph> Arguments to the plan. Can also include additional options: '\_catch\_errors', '\_run\_as'.</p></li></ul><p><b>Example:</b> Run a task</p><codeblock xml:space="preserve">run_task('facts', $targets, 'Gather OS facts')</codeblock></body></topic></topic><topic id="set-feature"><title>set\_feature</title><body><p>Sets a particular feature to present on a target.</p><p>Features are used to determine what implementation of a task should be run. Currently supported features are:</p><ul><li><p>powershell</p></li><li><p>shell</p></li><li><p>puppet-agent</p></li></ul><p><b>Note:</b> Not available in apply block.</p><codeblock xml:space="preserve">set_feature(Target $target, String $feature, Optional[Boolean] $value)</codeblock><p><i>Returns:</i> <codeph>Any</codeph> The target with the updated feature.</p><ul><li><p><b>target</b><codeph>Target</codeph> The Target object to add features to.  .</p></li><li><p><b>feature</b><codeph>String</codeph> The string identifying the feature.</p></li><li><p><b>value</b><codeph>Optional[Boolean]</codeph> Whether the feature is supported.</p></li></ul><p><b>Example:</b> Add the puppet-agent feature to a target</p><codeblock xml:space="preserve">set_feature($target, 'puppet-agent', true)</codeblock></body></topic><topic id="set-var"><title>set\_var</title><body><p>Sets a variable \{ key =\&gt; value \} for a target.</p><p><b>Note:</b> Not available in apply block.</p><codeblock xml:space="preserve">set_var(Target $target, String $key, Data $value)</codeblock><p><i>Returns:</i> <codeph>Undef</codeph></p><ul><li><p><b>target</b><codeph>Target</codeph> The Target object to set the variable for.  .</p></li><li><p><b>key</b><codeph>String</codeph> The key for the variable.</p></li><li><p><b>value</b><codeph>Data</codeph> The value of the variable.</p></li></ul><p><b>Example:</b> Set a variable on a target</p><codeblock xml:space="preserve">$target.set_var('ephemeral', true)</codeblock></body></topic><topic id="systemenv"><title>system::env</title><body><p>Get an environment variable.</p><codeblock xml:space="preserve">system::env(String $name)</codeblock><p><i>Returns:</i> <codeph>String</codeph></p><ul><li><p><b>name</b><codeph>String</codeph> Environment variable name.</p></li></ul><p><b>Example:</b> Get the USER environment variable</p><codeblock xml:space="preserve">system::env('USER')</codeblock></body></topic><topic id="upload-file"><title>upload\_file</title><body><p>Uploads the given file or directory to the given set of targets and returns the result from each upload. This function does nothing if the list of targets is empty.</p><p><b>Note:</b> Not available in apply block.</p></body><topic id="upload-a-file-or-directory"><title>Upload a file or directory.</title><body><codeblock xml:space="preserve">upload_file(String[1] $source, String[1] $destination, Boltlib::TargetSpec $targets, Optional[Hash[String[1], Any]] $options)</codeblock><p><i>Returns:</i><codeph>ResultSet</codeph> A list of results, one entry per target.</p><ul><li><p><b>source</b><codeph>String[1]</codeph> A source path, either an absolute path or a modulename/filename selector for a file or directory in &lt;moduleroot\&gt;/files.</p></li><li><p><b>destination</b><codeph>String[1]</codeph> An absolute path on the target\(s\).</p></li><li><p><b>targets</b><codeph>Boltlib::TargetSpec</codeph> A pattern identifying zero or more targets.   for accepted patterns.</p></li><li><p><b>options</b><codeph>Optional[Hash[String[1], Any]]</codeph> Additional options: '\_catch\_errors', '\_run\_as'.</p></li></ul><p><b>Example:</b> Upload a local file to Linux targets and change owner to 'root'</p><codeblock xml:space="preserve">upload_file('/var/tmp/payload.tgz', '/tmp/payload.tgz', $targets, '_run_as' =&gt; 'root')</codeblock><p><b>Example:</b> Upload a module file to a Windows target</p><codeblock xml:space="preserve">upload_file('postgres/default.conf', 'C:/ProgramData/postgres/default.conf', $target)</codeblock></body></topic><topic id="upload-a-file-or-directory-logging-the-provided-description"><title>Upload a file or directory, logging the provided description.</title><body><codeblock xml:space="preserve">upload_file(String[1] $source, String[1] $destination, Boltlib::TargetSpec $targets, String $description, Optional[Hash[String[1], Any]] $options)</codeblock><p><i>Returns:</i><codeph>ResultSet</codeph> A list of results, one entry per target.</p><ul><li><p><b>source</b><codeph>String[1]</codeph> A source path, either an absolute path or a modulename/filename selector for a file or directory in &lt;moduleroot\&gt;/files.</p></li><li><p><b>destination</b><codeph>String[1]</codeph> An absolute path on the target\(s\).</p></li><li><p><b>targets</b><codeph>Boltlib::TargetSpec</codeph> A pattern identifying zero or more targets.   for accepted patterns.</p></li><li><p><b>description</b><codeph>String</codeph> A description to be output when calling this function.</p></li><li><p><b>options</b><codeph>Optional[Hash[String[1], Any]]</codeph> Additional options: '\_catch\_errors', '\_run\_as'.</p></li></ul><p><b>Example:</b> Upload a file</p><codeblock xml:space="preserve">upload_file('/var/tmp/payload.tgz', '/tmp/payload.tgz', $targets, 'Uploading payload to unpack')</codeblock></body></topic></topic><topic id="vars"><title>vars</title><body><p>Returns a hash of the 'vars' \(variables\) assigned to a target.</p><p>Vars can be assigned through the inventory file or <codeph>set_var</codeph> function. Plan authors can call this function on a target to get the variable hash for that target.</p><codeblock xml:space="preserve">vars(Target $target)</codeblock><p><i>Returns:</i><codeph>Hash[String, Data]</codeph> A hash of the 'vars' \(variables\) assigned to a target.</p><ul><li><p><b>target</b><codeph>Target</codeph> The Target object to get variables from.  .</p></li></ul><p><b>Example:</b> Get vars for a target</p><codeblock xml:space="preserve">$target.vars</codeblock></body></topic><topic id="wait-until-available"><title>wait\_until\_available</title><body><p>Waits until all targets accept connections.</p><p><b>Note:</b> Not available in apply block.</p><codeblock xml:space="preserve">wait_until_available(Boltlib::TargetSpec $targets, Optional[Hash[String[1], Any]] $options)</codeblock><p><i>Returns:</i><codeph>ResultSet</codeph> A list of results, one entry per target. Successful results have no value.</p><ul><li><p><b>target</b><codeph>Boltlib::TargetSpec</codeph> A pattern identifying zero or more targets.   for accepted patterns.</p></li><li><p><b>options</b><codeph>Optional[Hash[String[1], Any]]</codeph>Additional options: <codeph>description</codeph>, <codeph>wait_time</codeph>, <codeph>retry_interval</codeph>, <codeph>_catch_errors</codeph>.</p></li></ul><p><b>Example:</b> Wait for targets</p><codeblock xml:space="preserve">wait_until_available($targets, wait_time =&gt; 300)</codeblock></body></topic><topic id="without-default-logging"><title>without\_default\_logging</title><body><p>Define a block where default logging is suppressed.</p><p>Messages for actions within this block are logged at <codeph>info</codeph> level instead of <codeph>notice</codeph>, so they are not seen normally but \# is still present when <codeph>verbose</codeph> logging is requested.</p><p><b>Note:</b> Not available in apply block.</p><codeblock xml:space="preserve">without_default_logging(Callable[0, 0] &amp;$block)</codeblock><p><i>Returns:</i> <codeph>Undef</codeph></p><ul><li><p><b>&amp;block</b><codeph>Callable[0, 0]</codeph> The block where action logging is suppressed.</p></li></ul><p><b>Example:</b> Suppress default logging for a series of functions</p><codeblock xml:space="preserve">without_default_logging() || {
  notice("Deploying on ${nodes}")
  get_targets($nodes).each |$node| {
    run_task(deploy, $node)
  }
}</codeblock></body></topic></topic></topic>
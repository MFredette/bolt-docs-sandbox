<?xml version="1.0" encoding="UTF-8"?><?path2rootmap-uri ./?>
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="generating-inventory-files"><title>Generating inventory files</title><prolog><author>Kate Lopresti &lt;kate.lopresti@puppet.com\&gt;</author></prolog><body><p>Use the <codeph>bolt-inventory-pdb</codeph> script to generate inventory files based on PuppetDB queries.</p></body><topic id="usage"><title>Usage</title><body><p>The <codeph>bolt-inventory-pdb</codeph> script accepts a single argument: the path of the source file used to generate the inventory file. It queries PuppetDB to resolve node lists and prints inventory yaml output to stdout or to a file you specify with the <codeph>-o</codeph> flag.</p><codeblock xml:space="preserve">bolt-inventory-pdb pdb.yaml -o ~/.puppetlabs/bolt/inventory.yaml</codeblock><p>For full usage information, type <codeph>bolt-inventory-pdb --help</codeph>.</p></body></topic><topic id="configuration"><title>Configuration</title><body><p>The <codeph>bolt-inventory-pdb</codeph> script uses the configuration file <codeph>puppetdb.conf</codeph>, which is stored at:</p><ul><li><p><b>\*nix systems</b> <codeph>$HOME/.puppetlabs/client-tools/puppetdb.conf</codeph></p></li><li><p><b>Windows</b> <codeph>%USERPROFILE%\.puppetlabs\client-tools\puppetdb.conf</codeph></p></li></ul><p><b>Note:</b> The precedence used to load puppetdb config is:</p><ol><li><p><codeph>configfile</codeph> \(optionally specified with <codeph>--configfile</codeph>\)</p></li><li><p><codeph>$HOME/.puppetlabs/client-tools/puppetdb.conf</codeph></p></li><li><p><codeph>/etc/puppetlabs/client-tools/puppetdb.conf</codeph> \(Windows: <codeph>C:\ProgramData\PuppetLabs\client-tools\puppetdb.conf</codeph>\)</p></li></ol><p><codeph>bolt-inventory-pdb</codeph> configuration can also be passed on the command line. These settings are required:</p><ul><li><p><codeph>--cacert</codeph> The path for the certification authority \(CA\) certificate.</p><p>\*nix systems - /etc/puppetlabs/puppet/ssl/certs/ca.pem</p><p>Windows - C:\\ProgramData\\PuppetLabs\\puppet\\etc\\ssl\\certs\\ca.pem</p></li><li><p><codeph>--url</codeph> The URL of your PuppetDB server.</p></li></ul><p>One of these authentication methods is required:</p><ul><li><p><codeph>--token-file</codeph> The path to the PE authorization token.</p></li><li><p><codeph>--cert</codeph> and <codeph>--key</codeph> The path to a client ssl certificate, and the private key for that certificate.</p></li></ul><codeblock xml:space="preserve">$ bolt-inventory-pdb pdb.yaml -o myfile.yaml --token-file ~/mytoken --cacert /etc/puppetlabs/puppet/ssl/certs/ca.pem --url  https://&lt;PUPPETDB_HOST&gt;:8081</codeblock></body></topic><topic id="file-format"><title>File format</title><body><p>The <codeph>bolt-inventory-pdb</codeph> tool generates an inventory file from a source yaml file. This file has the same format as the inventory file except instead of nodes keys it has query keys. The query should be a PuppetDB query in either <xref href="https://puppet.com/docs/puppetdb/latest/api/query/v4/pql.html" format="html" scope="external">Puppet Query Language \(PQL\)</xref> or <xref href="https://puppet.com/docs/puppetdb/latest/api/query/v4/ast.html" format="html" scope="external">PuppetDB AST</xref> syntax. When <codeph>bolt-inventory-pdb</codeph> runs it makes queries against PuppetDB and creates a nodes item for each group. This is an example of a file that adds all nodes to the top-level group, creates a Windows group configured to use the WinRM transport and a basil group for nodes with basil in the certname.</p><codeblock xml:space="preserve">query: "nodes[certname] {}"
groups:
  - name: windows
     query: "inventory[certname] { facts.osfamily = 'windows' }"
     config:
     transport: winrm
  - name: basil
    query: "nodes[certname] { certname ~ '^basil' }"</codeblock><p><b>Parent topic:</b><xref href="inventory_file.md" format="dita" type="topic">Inventory file</xref></p></body></topic></topic>
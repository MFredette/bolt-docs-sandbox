<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="copyright" content="(C) Copyright 2019"><meta name="DC.rights.owner" content="(C) Copyright 2019"><meta name="DC.type" content="topic"><meta name="DC.creator" content="Jean Bond <jean@puppet.com\&gt;"><meta name="DC.format" content="HTML5"><meta name="DC.identifier" content="plan-execution-functions-and-standard-libraries"><link rel="stylesheet" type="text/css" href="commonltr.css"><title>Plan execution functions and standard libraries</title></head><body id="plan-execution-functions-and-standard-libraries"><main role="main"><article role="article" aria-labelledby="ariaid-title1"><h1 class="title topictitle1" id="ariaid-title1">Plan execution functions and standard libraries</h1><div class="body"><p class="p">Your plan can execute multiple functions on remote systems.</p><p class="p">Your plan can include functions to run commands, scripts, tasks, and other plans on remote nodes. These execution functions correspond to task runner commands.</p><p class="p"><strong class="ph b">Note:</strong> All the&nbsp;$nodes&nbsp;arguments support the patterns supported by&nbsp;--nodes&nbsp;\(except for shell expansion\).</p></div><article class="topic nested1" aria-labelledby="ariaid-title2" id="bolt-functions"><h2 class="title topictitle2" id="ariaid-title2">Bolt functions</h2><div class="body"></div><article class="topic nested2" aria-labelledby="ariaid-title3" id="add-facts"><h3 class="title topictitle3" id="ariaid-title3">add\_facts</h3><div class="body"><p class="p">Deep merges a hash of facts with the existing facts on a target.</p><p class="p"><strong class="ph b">Note:</strong> Not available in apply block.</p><pre class="pre codeblock"><code>add_facts(Target $target, Hash $facts)</code></pre><p class="p"><em class="ph i">Returns:</em><code class="ph codeph">Hash[String, Data]</code> The target's new facts.</p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">target</strong><code class="ph codeph">Target</code> A target.</p></li><li class="li"><p class="p"><strong class="ph b">facts</strong><code class="ph codeph">Hash</code> A hash of fact names to values that may include structured facts.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Adding facts to a target</p><pre class="pre codeblock"><code>add_facts($target, { 'os' =&gt; { 'family' =&gt; 'windows', 'name' =&gt; 'windows' } })</code></pre></div></article><article class="topic nested2" aria-labelledby="ariaid-title4" id="add-to-group"><h3 class="title topictitle3" id="ariaid-title4">add\_to\_group</h3><div class="body"><p class="p">Adds a target to specified inventory group.</p><p class="p"><strong class="ph b">Note:</strong> Not available in apply block.</p><pre class="pre codeblock"><code>add_to_group(Boltlib::TargetSpec $targets, String[1] $group)</code></pre><p class="p"><em class="ph i">Returns:</em> <code class="ph codeph">Any</code></p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">targets</strong><code class="ph codeph">Boltlib::TargetSpec</code> A pattern or array of patterns identifying a set of targets.</p></li><li class="li"><p class="p"><strong class="ph b">group</strong><code class="ph codeph">String[1]</code> The name of the group to add targets to.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Add new target to group.</p><pre class="pre codeblock"><code>Target.new('foo@example.com', 'password' =&gt; 'secret').add_to_group('group1')</code></pre><p class="p"><strong class="ph b">Example:</strong> Add new target to group by name.</p><pre class="pre codeblock"><code>add_to_group('bolt:bolt@web.com', 'group1')</code></pre><p class="p"><strong class="ph b">Example:</strong> Add an array of targets to group by name.</p><pre class="pre codeblock"><code>add_to_group(['host1', 'group1', 'winrm://host2:54321'], 'group1')</code></pre><p class="p"><strong class="ph b">Example:</strong> Add a comma-separated list list of targets to group by name.</p><pre class="pre codeblock"><code>add_to_group('foo,bar,baz', 'group1')</code></pre></div></article><article class="topic nested2" aria-labelledby="ariaid-title5" id="apply-prep"><h3 class="title topictitle3" id="ariaid-title5">apply\_prep</h3><div class="body"><p class="p">Installs the puppet-agent package on targets, if needed, then collects facts, including any custom facts found in the Bolt modulepath.</p><p class="p">Agent detection is skipped if the target includes the <code class="ph codeph">puppet-agent</code> feature, either as a property of its transport \(PCP\) or by explicitly setting it as a feature in the Bolt inventory.</p><p class="p">If no agent is detected on the target using the <code class="ph codeph">puppet_agent::version</code> task, it's installed using <code class="ph codeph">puppet_agent::install</code> and the puppet service is stopped/disabled using the <code class="ph codeph">service</code> task.</p><p class="p"><strong class="ph b">Note:</strong> Not available in apply block.</p><pre class="pre codeblock"><code>apply_prep(Boltlib::TargetSpec $targets)</code></pre><p class="p"><em class="ph i">Returns:</em> <code class="ph codeph">Any</code></p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">targets</strong><code class="ph codeph">Boltlib::TargetSpec</code> A pattern or array of patterns identifying a set of targets.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Prepare targets by name.</p><pre class="pre codeblock"><code>apply_prep('target1,target2')</code></pre></div></article><article class="topic nested2" aria-labelledby="ariaid-title6" id="catch-errors"><h3 class="title topictitle3" id="ariaid-title6">catch\_errors</h3><div class="body"><p class="p">Catches errors in a given block and returns them, or returns the output of the block if no errors are raised. Accepts an optional list of error kinds to catch.</p><p class="p"><strong class="ph b">Note:</strong> Not available in apply block.</p><pre class="pre codeblock"><code>catch_errors(Optional[Array[String[1]]] $error_types, Callable[0, 0] &amp;$block)</code></pre><p class="p"><em class="ph i">Returns:</em> <code class="ph codeph">Undef</code> If an error is raised in the block, then the error is returned, otherwise the result is returned.</p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">error\_types</strong><code class="ph codeph">Optional[Array[String[1]]]</code> An array of error types to catch.</p></li><li class="li"><p class="p"><strong class="ph b">&amp;block</strong><code class="ph codeph">Callable[0, 0]</code> The block of steps to catch errors on.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Catch errors for a block.</p><pre class="pre codeblock"><code>catch_errors() || {
  run_command("whoami", $nodes)
  run_command("adduser ryan", $nodes)
}</code></pre><p class="p"><strong class="ph b">Example:</strong> Catch parse errors for a block of code.</p><pre class="pre codeblock"><code>catch_errors(['bolt/parse-error']) || {
 run_plan('canary', $nodes)
 run_plan('other_plan)
 apply($nodes) || {
   notify { "Hello": }
 }
}</code></pre></div></article><article class="topic nested2" aria-labelledby="ariaid-title7" id="ctrldo-until"><h3 class="title topictitle3" id="ariaid-title7">ctrl::do\_until</h3><div class="body"><p class="p">Repeat the block until it returns a truthy value. Returns the value.</p><pre class="pre codeblock"><code>ctrl::do_until(Callable &amp;$block)</code></pre><p class="p"><em class="ph i">Returns:</em> <code class="ph codeph">Any</code></p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">block</strong> <code class="ph codeph">Callable</code></p></li></ul><p class="p"><strong class="ph b">Example:</strong> Run a task until it succeeds</p><pre class="pre codeblock"><code>ctrl::do_until() || {
  run_task('test', $target, _catch_errors =&gt; true).ok?
}</code></pre></div></article><article class="topic nested2" aria-labelledby="ariaid-title8" id="ctrlsleep"><h3 class="title topictitle3" id="ariaid-title8">ctrl::sleep</h3><div class="body"><p class="p">Sleeps for specified number of seconds.</p><pre class="pre codeblock"><code>ctrl::sleep(Numeric $period)</code></pre><p class="p"><em class="ph i">Returns:</em> <code class="ph codeph">Undef</code></p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">period</strong><code class="ph codeph">Numeric</code> time to sleep \(in seconds\)</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Sleep for 5 seconds</p><pre class="pre codeblock"><code>ctrl::sleep(5)</code></pre></div></article><article class="topic nested2" aria-labelledby="ariaid-title9" id="facts"><h3 class="title topictitle3" id="ariaid-title9">facts</h3><div class="body"><p class="p">Returns the facts hash for a target.</p><pre class="pre codeblock"><code>facts(Target $target)</code></pre><p class="p"><em class="ph i">Returns:</em><code class="ph codeph">Hash[String, Data]</code> The target's facts.</p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">target</strong><code class="ph codeph">Target</code> A target.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Getting facts</p><pre class="pre codeblock"><code>facts($target)</code></pre></div></article><article class="topic nested2" aria-labelledby="ariaid-title10" id="fail-plan"><h3 class="title topictitle3" id="ariaid-title10">fail\_plan</h3><div class="body"><p class="p">Raises a Bolt::PlanFailure exception to signal to callers that the plan failed.</p><p class="p">Plan authors should call this function when their plan is not successful. The error may then be caught by another plans run\_plan function or in bolt itself.</p><p class="p"><strong class="ph b">Note:</strong> Not available in apply block.</p></div><article class="topic nested3" aria-labelledby="ariaid-title11" id="fail-a-plan-generating-an-exception-from-the-parameters"><h4 class="title topictitle4" id="ariaid-title11">Fail a plan, generating an exception from the parameters.</h4><div class="body"><pre class="pre codeblock"><code>fail_plan(String[1] $msg, Optional[String[1]] $kind, Optional[Hash[String[1], Any]] $details, Optional[String[1]] $issue_code)</code></pre><p class="p"><em class="ph i">Returns:</em><code class="ph codeph">Any</code> Raises an exception.</p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">msg</strong><code class="ph codeph">String[1]</code> An error message.</p></li><li class="li"><p class="p"><strong class="ph b">kind</strong><code class="ph codeph">Optional[String[1]]</code> An easily matchable error kind.</p></li><li class="li"><p class="p"><strong class="ph b">details</strong><code class="ph codeph">Optional[Hash[String[1], Any]]</code> Machine-parseable details about the error.</p></li><li class="li"><p class="p"><strong class="ph b">issue\_code</strong><code class="ph codeph">Optional[String[1]]</code> Unused.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Raise an exception</p><pre class="pre codeblock"><code>fail_plan('We goofed up', 'task-unexpected-result', { 'result' =&gt; 'null' })</code></pre></div></article><article class="topic nested3" aria-labelledby="ariaid-title12" id="fail-a-plan-generating-an-exception-from-an-existing-error-object"><h4 class="title topictitle4" id="ariaid-title12">Fail a plan, generating an exception from an existing Error object.</h4><div class="body"><pre class="pre codeblock"><code>fail_plan(Error $error)</code></pre><p class="p"><em class="ph i">Returns:</em><code class="ph codeph">Any</code> Raises an exception.</p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">error</strong><code class="ph codeph">Error</code> An error object.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Raise an exception</p><pre class="pre codeblock"><code>fail_plan(Error('We goofed up', 'task-unexpected-result', { 'result' =&gt; 'null' }))</code></pre></div></article></article><article class="topic nested2" aria-labelledby="ariaid-title13" id="fileexists"><h3 class="title topictitle3" id="ariaid-title13">file::exists</h3><div class="body"><p class="p">Check if a file exists.</p><pre class="pre codeblock"><code>file::exists(String $filename)</code></pre><p class="p"><em class="ph i">Returns:</em> <code class="ph codeph">Boolean</code></p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">filename</strong><code class="ph codeph">String</code> Absolute path or Puppet file path.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Check a file on disk</p><pre class="pre codeblock"><code>file::exists('/tmp/i_dumped_this_here')</code></pre><p class="p"><strong class="ph b">Example:</strong> Check a file from the modulepath</p><pre class="pre codeblock"><code>file::exists('example/files/VERSION')</code></pre></div></article><article class="topic nested2" aria-labelledby="ariaid-title14" id="fileread"><h3 class="title topictitle3" id="ariaid-title14">file::read</h3><div class="body"><p class="p">Read a file and return its contents.</p><pre class="pre codeblock"><code>file::read(String $filename)</code></pre><p class="p"><em class="ph i">Returns:</em> <code class="ph codeph">String</code></p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">filename</strong><code class="ph codeph">String</code> Absolute path or Puppet file path.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Read a file from disk</p><pre class="pre codeblock"><code>file::read('/tmp/i_dumped_this_here')</code></pre><p class="p"><strong class="ph b">Example:</strong> Read a file from the modulepath</p><pre class="pre codeblock"><code>file::read('example/files/VERSION')</code></pre></div></article><article class="topic nested2" aria-labelledby="ariaid-title15" id="filereadable"><h3 class="title topictitle3" id="ariaid-title15">file::readable</h3><div class="body"><p class="p">Check if a file is readable.</p><pre class="pre codeblock"><code>
file::readable(String $filename)</code></pre><p class="p"><em class="ph i">Returns:</em> <code class="ph codeph">Boolean</code></p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">filename</strong><code class="ph codeph">String</code> Absolute path or Puppet file path.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Check a file on disk</p><pre class="pre codeblock"><code>file::readable('/tmp/i_dumped_this_here')</code></pre><p class="p"><strong class="ph b">Example:</strong> Check a file from the modulepath</p><pre class="pre codeblock"><code>file::readable('example/files/VERSION')</code></pre></div></article><article class="topic nested2" aria-labelledby="ariaid-title16" id="filewrite"><h3 class="title topictitle3" id="ariaid-title16">file::write</h3><div class="body"><p class="p">Write a string to a file.</p><pre class="pre codeblock"><code>file::write(String $filename, String $content)</code></pre><p class="p"><em class="ph i">Returns:</em> <code class="ph codeph">Undef</code></p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">filename</strong><code class="ph codeph">String</code> Absolute path.</p></li><li class="li"><p class="p"><strong class="ph b">content</strong><code class="ph codeph">String</code> File content to write.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Write a file to disk</p><pre class="pre codeblock"><code>file::write('C:/Users/me/report', $apply_result.first.report)</code></pre></div></article><article class="topic nested2" aria-labelledby="ariaid-title17" id="get-resources"><h3 class="title topictitle3" id="ariaid-title17">get\_resources</h3><div class="body"><p class="p">Query the state of resources on a list of targets using resource definitions in the Bolt module path. The results are returned as a list of hashes representing each resource.</p><p class="p">The Puppet agent must be installed on the target. You can install the agent with the<code class="ph codeph">apply_prep</code> function or by directly running the <code class="ph codeph">puppet_agent::install</code> task.</p><p class="p"><strong class="ph b">Note:</strong> Not available in apply block.</p><pre class="pre codeblock"><code>get_resources(Boltlib::TargetSpec $targets, Variant[String, Resource, Array[Variant[String, Resource]]] $resources)</code></pre><p class="p"><em class="ph i">Returns:</em> <code class="ph codeph">Any</code></p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">targets</strong><code class="ph codeph">Boltlib::TargetSpec</code> A pattern or array of patterns identifying a set of targets.</p></li><li class="li"><p class="p"><strong class="ph b">resources</strong><code class="ph codeph">Variant[String, Resource, Array[Variant[String, Resource]]]</code> A resource type or instance, or an array of such.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Collect resource states for packages and a file</p><pre class="pre codeblock"><code>get_resources('target1,target2', [Package, File[/etc/puppetlabs]])</code></pre></div></article><article class="topic nested2" aria-labelledby="ariaid-title18" id="get-targets"><h3 class="title topictitle3" id="ariaid-title18">get\_targets</h3><div class="body"><p class="p">Parses common ways of referring to targets and returns an array of Targets.</p><pre class="pre codeblock"><code>get_targets(Boltlib::TargetSpec $names)</code></pre><p class="p"><em class="ph i">Returns:</em><code class="ph codeph">Array[Target]</code> A list of unique Targets resolved from any target URIs and groups.</p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">names</strong><code class="ph codeph">Boltlib::TargetSpec</code> A pattern or array of patterns identifying a set of targets.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Resolve a group</p><pre class="pre codeblock"><code>get_targets('group1')</code></pre><p class="p"><strong class="ph b">Example:</strong> Resolve a target URI</p><pre class="pre codeblock"><code>get_targets('winrm://host2:54321')</code></pre><p class="p"><strong class="ph b">Example:</strong> Resolve array of groups and/or target URIs</p><pre class="pre codeblock"><code>get_targets(['host1', 'group1', 'winrm://host2:54321'])</code></pre><p class="p"><strong class="ph b">Example:</strong> Resolve string consisting of a comma-separated list of groups and/or target URIs</p><pre class="pre codeblock"><code>get_targets('host1,group1,winrm://host2:54321')</code></pre><p class="p"><strong class="ph b">Example:</strong> Run on localhost</p><pre class="pre codeblock"><code>get_targets('localhost')</code></pre></div></article><article class="topic nested2" aria-labelledby="ariaid-title19" id="outmessage"><h3 class="title topictitle3" id="ariaid-title19">out::message</h3><div class="body"><p class="p">Output a message for the user.</p><p class="p">This will print a message to stdout when using the human output format.</p><p class="p"><strong class="ph b">Note:</strong> Not available in apply block.</p><pre class="pre codeblock"><code>out::message(String $message)</code></pre><p class="p"><em class="ph i">Returns:</em><code class="ph codeph">Undef</code></p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">message</strong><code class="ph codeph">String</code> The message to output.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Print a message</p><pre class="pre codeblock"><code>out::message('Something went wrong')</code></pre></div></article><article class="topic nested2" aria-labelledby="ariaid-title20" id="puppetdb-fact"><h3 class="title topictitle3" id="ariaid-title20">puppetdb\_fact</h3><div class="body"><p class="p">Collects facts based on a list of certnames.</p><ul class="ul"><li class="li"><p class="p">If a node is not found in PuppetDB, it's included in the returned hash with empty facts hash.</p></li><li class="li"><p class="p">Otherwise the node is included in the hash with a value that is a hash of it's facts.</p></li></ul><pre class="pre codeblock"><code>puppetdb_fact(Array[String] $certnames)</code></pre><p class="p"><em class="ph i">Returns:</em><code class="ph codeph">Hash[String, Data]</code> A hash of certname to facts hash for each matched Target.</p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">certnames</strong><code class="ph codeph">Array[String]</code> Array of certnames.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Get facts for nodes</p><pre class="pre codeblock"><code>puppetdb_fact(['app.example.com', 'db.example.com'])</code></pre></div></article><article class="topic nested2" aria-labelledby="ariaid-title21" id="puppetdb-query"><h3 class="title topictitle3" id="ariaid-title21">puppetdb\_query</h3><div class="body"><p class="p">Makes a query to PuppetDB using Bolt's PuppetDB client.</p><pre class="pre codeblock"><code>puppetdb_query(Variant[String, Array[Data]] $query)</code></pre><p class="p"><em class="ph i">Returns:</em><code class="ph codeph">Array[Data]</code> Results of the PuppetDB query.</p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">query</strong><code class="ph codeph">Variant[String, Array[Data]]</code> A PQL query.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Request certnames for all nodes</p><pre class="pre codeblock"><code>puppetdb_query('nodes[certname] {}')</code></pre><p class="p"><strong class="ph b">Related information</strong></p><p class="p"><a class="xref" href="https://puppet.com/docs/puppetdb/latest/index.html" target="_blank">PuppetDB</a></p><p class="p"><a class="xref" href="https://puppet.com/docs/puppetdb/latest/api/query/tutorial-pql.html" target="_blank">Puppet Query Language</a></p></div></article><article class="topic nested2" aria-labelledby="ariaid-title22" id="run-command"><h3 class="title topictitle3" id="ariaid-title22">run\_command</h3><div class="body"><p class="p">Runs a command on the given set of targets and returns the result from each command execution. This function does nothing if the list of targets is empty.</p><p class="p"><strong class="ph b">Note:</strong> Not available in apply block.</p></div><article class="topic nested3" aria-labelledby="ariaid-title23" id="run-a-command"><h4 class="title topictitle4" id="ariaid-title23">Run a command.</h4><div class="body"><pre class="pre codeblock"><code>run_command(String[1] $command, Boltlib::TargetSpec $targets, Optional[Hash[String[1], Any]] $options)</code></pre><p class="p"><em class="ph i">Returns:</em><code class="ph codeph">ResultSet</code> A list of results, one entry per target.</p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">command</strong><code class="ph codeph">String[1]</code> A command to run on target.</p></li><li class="li"><p class="p"><strong class="ph b">targets</strong><code class="ph codeph">Boltlib::TargetSpec</code> A pattern identifying zero or more targets. See <code class="ph codeph">get_targets</code> for accepted patterns.</p></li><li class="li"><p class="p"><strong class="ph b">options</strong><code class="ph codeph">Optional[Hash[String[1], Any]]</code> Additional options: '\_catch\_errors', '\_run\_as'.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Run a command on targets</p><pre class="pre codeblock"><code>run_command('hostname', $targets, '_catch_errors' =&gt; true)</code></pre></div></article><article class="topic nested3" aria-labelledby="ariaid-title24" id="run-a-command-logging-the-provided-description"><h4 class="title topictitle4" id="ariaid-title24">Run a command, logging the provided description.</h4><div class="body"><pre class="pre codeblock"><code>run_command(String[1] $command, Boltlib::TargetSpec $targets, String $description, Optional[Hash[String[1], Any]] $options)</code></pre><p class="p"><em class="ph i">Returns:</em><code class="ph codeph">ResultSet</code> A list of results, one entry per target.</p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">command</strong><code class="ph codeph">String[1]</code> A command to run on target.</p></li><li class="li"><p class="p"><strong class="ph b">targets</strong><code class="ph codeph">Boltlib::TargetSpec</code> A pattern identifying zero or more targets. See <code class="ph codeph">get_targets</code>for accepted patterns.</p></li><li class="li"><p class="p"><strong class="ph b">description</strong><code class="ph codeph">String</code> A description to be output when calling this function.</p></li><li class="li"><p class="p"><strong class="ph b">options</strong><code class="ph codeph">Optional[Hash[String[1], Any]]</code> Additional options: '\_catch\_errors', '\_run\_as'.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Run a command on targets</p><pre class="pre codeblock"><code>run_command('hostname', $targets, '_catch_errors' =&gt; true)</code></pre></div></article></article><article class="topic nested2" aria-labelledby="ariaid-title25" id="run-plan"><h3 class="title topictitle3" id="ariaid-title25">run\_plan</h3><div class="body"><p class="p">Runs the <code class="ph codeph">plan</code> referenced by its name. A plan is autoloaded from <code class="ph codeph">&lt;moduleroot&gt;/plans</code>.</p><p class="p"><strong class="ph b">Note:</strong> Not available in apply block.</p></div><article class="topic nested3" aria-labelledby="ariaid-title26" id="run-a-plan"><h4 class="title topictitle4" id="ariaid-title26">Run a plan.</h4><div class="body"><pre class="pre codeblock"><code>run_plan(String $plan_name, Optional[Hash] $named_args)</code></pre><p class="p"><em class="ph i">Returns:</em><code class="ph codeph">Boltlib::PlanResult</code> The result of running the plan. Undef if plan does not explicitly return results.</p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">plan\_name</strong><code class="ph codeph">String</code> The plan to run.</p></li><li class="li"><p class="p"><strong class="ph b">named\_args</strong><code class="ph codeph">Optional[Hash]</code> Arguments to the plan. Can also include additional options: '\_catch\_errors', '\_run\_as'.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Run a plan</p><pre class="pre codeblock"><code>run_plan('canary', 'command' =&gt; 'false', 'nodes' =&gt; $targets, '_catch_errors' =&gt; true)</code></pre></div></article><article class="topic nested3" aria-labelledby="ariaid-title27" id="run-a-plan-specifying-nodes-as-a-positional-argument"><h4 class="title topictitle4" id="ariaid-title27">Run a plan, specifying $nodes as a positional argument.</h4><div class="body"><pre class="pre codeblock"><code>run_plan(String $plan_name, Boltlib::TargetSpec $targets, Optional[Hash] $named_args)</code></pre><p class="p"><em class="ph i">Returns:</em><code class="ph codeph">Boltlib::PlanResult</code> The result of running the plan. Undef if plan does not explicitly return results.</p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">plan\_name</strong><code class="ph codeph">String</code> The plan to run.</p></li><li class="li"><p class="p"><strong class="ph b">named\_args</strong><code class="ph codeph">Optional[Hash]</code> Arguments to the plan. Can also include additional options: '\_catch\_errors', '\_run\_as'.</p></li><li class="li"><p class="p"><strong class="ph b">targets</strong><code class="ph codeph">Boltlib::TargetSpec</code> A pattern identifying zero or more targets. See the get\_targets function for accepted patterns.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Run a plan</p><pre class="pre codeblock"><code>run_plan('canary', '$nodes', 'command' =&gt; 'false')</code></pre></div></article></article><article class="topic nested2" aria-labelledby="ariaid-title28" id="run-script"><h3 class="title topictitle3" id="ariaid-title28">run\_script</h3><div class="body"><p class="p">Uploads the given script to the given set of targets and returns the result of having each target execute the script. This function does nothing if the list of targets is empty.</p><p class="p"><strong class="ph b">Note:</strong> Not available in apply block.</p></div><article class="topic nested3" aria-labelledby="ariaid-title29" id="run-a-script"><h4 class="title topictitle4" id="ariaid-title29">Run a script.</h4><div class="body"><pre class="pre codeblock"><code>run_script(String[1] $script, Boltlib::TargetSpec $targets, Optional[Hash[String[1], Any]] $options)</code></pre><p class="p"><em class="ph i">Returns:</em><code class="ph codeph">ResultSet</code> A list of results, one entry per target.</p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">script</strong><code class="ph codeph">String[1]</code> Path to a script to run on target. May be an absolute path or a modulename/filename selector for a file in &lt;moduleroot\&gt;/files.</p></li><li class="li"><p class="p"><strong class="ph b">targets</strong><code class="ph codeph">Boltlib::TargetSpec</code> A pattern identifying zero or more targets. See for accepted patterns.</p></li><li class="li"><p class="p"><strong class="ph b">options</strong><code class="ph codeph">Optional[Hash[String[1], Any]]</code> Specify an array of arguments to the 'arguments' key to be passed to the script. Additional options: '\_catch\_errors', '\_run\_as'.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Run a local script on Linux targets as 'root'</p><pre class="pre codeblock"><code>run_script('/var/tmp/myscript', $targets, '_run_as' =&gt; 'root')</code></pre><p class="p"><strong class="ph b">Example:</strong> Run a module-provided script with arguments</p><pre class="pre codeblock"><code>run_script('iis/setup.ps1', $target, 'arguments' =&gt; ['/u', 'Administrator'])</code></pre></div></article><article class="topic nested3" aria-labelledby="ariaid-title30" id="run-a-script-logging-the-provided-description"><h4 class="title topictitle4" id="ariaid-title30">Run a script, logging the provided description.</h4><div class="body"><pre class="pre codeblock"><code>run_script(String[1] $script, Boltlib::TargetSpec $targets, String $description, Optional[Hash[String[1], Any]] $options)</code></pre><p class="p"><em class="ph i">Returns:</em><code class="ph codeph">ResultSet</code> A list of results, one entry per target.</p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">script</strong><code class="ph codeph">String[1]</code> Path to a script to run on target. May be an absolute path or a modulename/filename selector for a file in &lt;moduleroot\&gt;/files.</p></li><li class="li"><p class="p"><strong class="ph b">targets</strong><code class="ph codeph">Boltlib::TargetSpec</code> A pattern identifying zero or more targets.   for accepted patterns.</p></li><li class="li"><p class="p"><strong class="ph b">description</strong><code class="ph codeph">String</code> A description to be output when calling this function.</p></li><li class="li"><p class="p"><strong class="ph b">options</strong><code class="ph codeph">Optional[Hash[String[1], Any]]</code> Specify an array of arguments to the 'arguments' key to be passed to the script. Additional options: '\_catch\_errors', '\_run\_as'.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Run a script</p><pre class="pre codeblock"><code>run_script('/var/tmp/myscript', $targets, 'Downloading my application')</code></pre></div></article></article><article class="topic nested2" aria-labelledby="ariaid-title31" id="run-task"><h3 class="title topictitle3" id="ariaid-title31">run\_task</h3><div class="body"><p class="p">Runs a given instance of a <code class="ph codeph">Task</code> on the given set of targets and returns the result from each. This function does nothing if the list of targets is empty.</p><p class="p"><strong class="ph b">Note:</strong> Not available in apply block.</p></div><article class="topic nested3" aria-labelledby="ariaid-title32" id="run-a-task"><h4 class="title topictitle4" id="ariaid-title32">Run a task.</h4><div class="body"><pre class="pre codeblock"><code>run_task(String[1] $task_name, Boltlib::TargetSpec $targets, Optional[Hash[String[1], Any]] $task_args)</code></pre><p class="p"><em class="ph i">Returns:</em><code class="ph codeph">ResultSet</code> A list of results, one entry per target.</p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">task\_name</strong><code class="ph codeph">String[1]</code> The task to run.</p></li><li class="li"><p class="p"><strong class="ph b">targets</strong><code class="ph codeph">Boltlib::TargetSpec</code> A pattern identifying zero or more targets.   for accepted patterns.</p></li><li class="li"><p class="p"><strong class="ph b">task\_args</strong><code class="ph codeph">Optional[Hash[String[1], Any]]</code> Arguments to the plan. Can also include additional options: '\_catch\_errors', '\_run\_as'.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Run a task as root</p><pre class="pre codeblock"><code>run_task('facts', $targets, '_run_as' =&gt; 'root')</code></pre></div></article><article class="topic nested3" aria-labelledby="ariaid-title33" id="run-a-task-logging-the-provided-description"><h4 class="title topictitle4" id="ariaid-title33">Run a task, logging the provided description.</h4><div class="body"><pre class="pre codeblock"><code>run_task(String[1] $task_name, Boltlib::TargetSpec $targets, Optional[String] $description, Optional[Hash[String[1], Any]] $task_args)</code></pre><p class="p"><em class="ph i">Returns:</em><code class="ph codeph">ResultSet</code> A list of results, one entry per target.</p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">task\_name</strong><code class="ph codeph">String[1]</code> The task to run.</p></li><li class="li"><p class="p"><strong class="ph b">targets</strong><code class="ph codeph">Boltlib::TargetSpec</code> A pattern identifying zero or more targets.   for accepted patterns.</p></li><li class="li"><p class="p"><strong class="ph b">description</strong><code class="ph codeph">Optional[String]</code> A description to be output when calling this function.</p></li><li class="li"><p class="p"><strong class="ph b">task\_args</strong><code class="ph codeph">Optional[Hash[String[1], Any]]</code> Arguments to the plan. Can also include additional options: '\_catch\_errors', '\_run\_as'.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Run a task</p><pre class="pre codeblock"><code>run_task('facts', $targets, 'Gather OS facts')</code></pre></div></article></article><article class="topic nested2" aria-labelledby="ariaid-title34" id="set-feature"><h3 class="title topictitle3" id="ariaid-title34">set\_feature</h3><div class="body"><p class="p">Sets a particular feature to present on a target.</p><p class="p">Features are used to determine what implementation of a task should be run. Currently supported features are:</p><ul class="ul"><li class="li"><p class="p">powershell</p></li><li class="li"><p class="p">shell</p></li><li class="li"><p class="p">puppet-agent</p></li></ul><p class="p"><strong class="ph b">Note:</strong> Not available in apply block.</p><pre class="pre codeblock"><code>set_feature(Target $target, String $feature, Optional[Boolean] $value)</code></pre><p class="p"><em class="ph i">Returns:</em> <code class="ph codeph">Any</code> The target with the updated feature.</p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">target</strong><code class="ph codeph">Target</code> The Target object to add features to.  .</p></li><li class="li"><p class="p"><strong class="ph b">feature</strong><code class="ph codeph">String</code> The string identifying the feature.</p></li><li class="li"><p class="p"><strong class="ph b">value</strong><code class="ph codeph">Optional[Boolean]</code> Whether the feature is supported.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Add the puppet-agent feature to a target</p><pre class="pre codeblock"><code>set_feature($target, 'puppet-agent', true)</code></pre></div></article><article class="topic nested2" aria-labelledby="ariaid-title35" id="set-var"><h3 class="title topictitle3" id="ariaid-title35">set\_var</h3><div class="body"><p class="p">Sets a variable \{ key =\&gt; value \} for a target.</p><p class="p"><strong class="ph b">Note:</strong> Not available in apply block.</p><pre class="pre codeblock"><code>set_var(Target $target, String $key, Data $value)</code></pre><p class="p"><em class="ph i">Returns:</em> <code class="ph codeph">Undef</code></p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">target</strong><code class="ph codeph">Target</code> The Target object to set the variable for.  .</p></li><li class="li"><p class="p"><strong class="ph b">key</strong><code class="ph codeph">String</code> The key for the variable.</p></li><li class="li"><p class="p"><strong class="ph b">value</strong><code class="ph codeph">Data</code> The value of the variable.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Set a variable on a target</p><pre class="pre codeblock"><code>$target.set_var('ephemeral', true)</code></pre></div></article><article class="topic nested2" aria-labelledby="ariaid-title36" id="systemenv"><h3 class="title topictitle3" id="ariaid-title36">system::env</h3><div class="body"><p class="p">Get an environment variable.</p><pre class="pre codeblock"><code>system::env(String $name)</code></pre><p class="p"><em class="ph i">Returns:</em> <code class="ph codeph">String</code></p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">name</strong><code class="ph codeph">String</code> Environment variable name.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Get the USER environment variable</p><pre class="pre codeblock"><code>system::env('USER')</code></pre></div></article><article class="topic nested2" aria-labelledby="ariaid-title37" id="upload-file"><h3 class="title topictitle3" id="ariaid-title37">upload\_file</h3><div class="body"><p class="p">Uploads the given file or directory to the given set of targets and returns the result from each upload. This function does nothing if the list of targets is empty.</p><p class="p"><strong class="ph b">Note:</strong> Not available in apply block.</p></div><article class="topic nested3" aria-labelledby="ariaid-title38" id="upload-a-file-or-directory"><h4 class="title topictitle4" id="ariaid-title38">Upload a file or directory.</h4><div class="body"><pre class="pre codeblock"><code>upload_file(String[1] $source, String[1] $destination, Boltlib::TargetSpec $targets, Optional[Hash[String[1], Any]] $options)</code></pre><p class="p"><em class="ph i">Returns:</em><code class="ph codeph">ResultSet</code> A list of results, one entry per target.</p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">source</strong><code class="ph codeph">String[1]</code> A source path, either an absolute path or a modulename/filename selector for a file or directory in &lt;moduleroot\&gt;/files.</p></li><li class="li"><p class="p"><strong class="ph b">destination</strong><code class="ph codeph">String[1]</code> An absolute path on the target\(s\).</p></li><li class="li"><p class="p"><strong class="ph b">targets</strong><code class="ph codeph">Boltlib::TargetSpec</code> A pattern identifying zero or more targets.   for accepted patterns.</p></li><li class="li"><p class="p"><strong class="ph b">options</strong><code class="ph codeph">Optional[Hash[String[1], Any]]</code> Additional options: '\_catch\_errors', '\_run\_as'.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Upload a local file to Linux targets and change owner to 'root'</p><pre class="pre codeblock"><code>upload_file('/var/tmp/payload.tgz', '/tmp/payload.tgz', $targets, '_run_as' =&gt; 'root')</code></pre><p class="p"><strong class="ph b">Example:</strong> Upload a module file to a Windows target</p><pre class="pre codeblock"><code>upload_file('postgres/default.conf', 'C:/ProgramData/postgres/default.conf', $target)</code></pre></div></article><article class="topic nested3" aria-labelledby="ariaid-title39" id="upload-a-file-or-directory-logging-the-provided-description"><h4 class="title topictitle4" id="ariaid-title39">Upload a file or directory, logging the provided description.</h4><div class="body"><pre class="pre codeblock"><code>upload_file(String[1] $source, String[1] $destination, Boltlib::TargetSpec $targets, String $description, Optional[Hash[String[1], Any]] $options)</code></pre><p class="p"><em class="ph i">Returns:</em><code class="ph codeph">ResultSet</code> A list of results, one entry per target.</p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">source</strong><code class="ph codeph">String[1]</code> A source path, either an absolute path or a modulename/filename selector for a file or directory in &lt;moduleroot\&gt;/files.</p></li><li class="li"><p class="p"><strong class="ph b">destination</strong><code class="ph codeph">String[1]</code> An absolute path on the target\(s\).</p></li><li class="li"><p class="p"><strong class="ph b">targets</strong><code class="ph codeph">Boltlib::TargetSpec</code> A pattern identifying zero or more targets.   for accepted patterns.</p></li><li class="li"><p class="p"><strong class="ph b">description</strong><code class="ph codeph">String</code> A description to be output when calling this function.</p></li><li class="li"><p class="p"><strong class="ph b">options</strong><code class="ph codeph">Optional[Hash[String[1], Any]]</code> Additional options: '\_catch\_errors', '\_run\_as'.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Upload a file</p><pre class="pre codeblock"><code>upload_file('/var/tmp/payload.tgz', '/tmp/payload.tgz', $targets, 'Uploading payload to unpack')</code></pre></div></article></article><article class="topic nested2" aria-labelledby="ariaid-title40" id="vars"><h3 class="title topictitle3" id="ariaid-title40">vars</h3><div class="body"><p class="p">Returns a hash of the 'vars' \(variables\) assigned to a target.</p><p class="p">Vars can be assigned through the inventory file or <code class="ph codeph">set_var</code> function. Plan authors can call this function on a target to get the variable hash for that target.</p><pre class="pre codeblock"><code>vars(Target $target)</code></pre><p class="p"><em class="ph i">Returns:</em><code class="ph codeph">Hash[String, Data]</code> A hash of the 'vars' \(variables\) assigned to a target.</p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">target</strong><code class="ph codeph">Target</code> The Target object to get variables from.  .</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Get vars for a target</p><pre class="pre codeblock"><code>$target.vars</code></pre></div></article><article class="topic nested2" aria-labelledby="ariaid-title41" id="wait-until-available"><h3 class="title topictitle3" id="ariaid-title41">wait\_until\_available</h3><div class="body"><p class="p">Waits until all targets accept connections.</p><p class="p"><strong class="ph b">Note:</strong> Not available in apply block.</p><pre class="pre codeblock"><code>wait_until_available(Boltlib::TargetSpec $targets, Optional[Hash[String[1], Any]] $options)</code></pre><p class="p"><em class="ph i">Returns:</em><code class="ph codeph">ResultSet</code> A list of results, one entry per target. Successful results have no value.</p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">target</strong><code class="ph codeph">Boltlib::TargetSpec</code> A pattern identifying zero or more targets.   for accepted patterns.</p></li><li class="li"><p class="p"><strong class="ph b">options</strong><code class="ph codeph">Optional[Hash[String[1], Any]]</code>Additional options: <code class="ph codeph">description</code>, <code class="ph codeph">wait_time</code>, <code class="ph codeph">retry_interval</code>, <code class="ph codeph">_catch_errors</code>.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Wait for targets</p><pre class="pre codeblock"><code>wait_until_available($targets, wait_time =&gt; 300)</code></pre></div></article><article class="topic nested2" aria-labelledby="ariaid-title42" id="without-default-logging"><h3 class="title topictitle3" id="ariaid-title42">without\_default\_logging</h3><div class="body"><p class="p">Define a block where default logging is suppressed.</p><p class="p">Messages for actions within this block are logged at <code class="ph codeph">info</code> level instead of <code class="ph codeph">notice</code>, so they are not seen normally but \# is still present when <code class="ph codeph">verbose</code> logging is requested.</p><p class="p"><strong class="ph b">Note:</strong> Not available in apply block.</p><pre class="pre codeblock"><code>without_default_logging(Callable[0, 0] &amp;$block)</code></pre><p class="p"><em class="ph i">Returns:</em> <code class="ph codeph">Undef</code></p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">&amp;block</strong><code class="ph codeph">Callable[0, 0]</code> The block where action logging is suppressed.</p></li></ul><p class="p"><strong class="ph b">Example:</strong> Suppress default logging for a series of functions</p><pre class="pre codeblock"><code>without_default_logging() || {
  notice("Deploying on ${nodes}")
  get_targets($nodes).each |$node| {
    run_task(deploy, $node)
  }
}</code></pre></div></article></article></article></main></body></html>
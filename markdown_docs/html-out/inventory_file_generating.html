<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="copyright" content="(C) Copyright 2019"><meta name="DC.rights.owner" content="(C) Copyright 2019"><meta name="DC.type" content="topic"><meta name="DC.creator" content="Kate Lopresti <kate.lopresti@puppet.com\&gt;"><meta name="DC.format" content="HTML5"><meta name="DC.identifier" content="generating-inventory-files"><link rel="stylesheet" type="text/css" href="commonltr.css"><title>Generating inventory files</title></head><body id="generating-inventory-files"><main role="main"><article role="article" aria-labelledby="ariaid-title1"><h1 class="title topictitle1" id="ariaid-title1">Generating inventory files</h1><div class="body"><p class="p">Use the <code class="ph codeph">bolt-inventory-pdb</code> script to generate inventory files based on PuppetDB queries.</p></div><article class="topic nested1" aria-labelledby="ariaid-title2" id="usage"><h2 class="title topictitle2" id="ariaid-title2">Usage</h2><div class="body"><p class="p">The <code class="ph codeph">bolt-inventory-pdb</code> script accepts a single argument: the path of the source file used to generate the inventory file. It queries PuppetDB to resolve node lists and prints inventory yaml output to stdout or to a file you specify with the <code class="ph codeph">-o</code> flag.</p><pre class="pre codeblock"><code>bolt-inventory-pdb pdb.yaml -o ~/.puppetlabs/bolt/inventory.yaml</code></pre><p class="p">For full usage information, type <code class="ph codeph">bolt-inventory-pdb --help</code>.</p></div></article><article class="topic nested1" aria-labelledby="ariaid-title3" id="configuration"><h2 class="title topictitle2" id="ariaid-title3">Configuration</h2><div class="body"><p class="p">The <code class="ph codeph">bolt-inventory-pdb</code> script uses the configuration file <code class="ph codeph">puppetdb.conf</code>, which is stored at:</p><ul class="ul"><li class="li"><p class="p"><strong class="ph b">\*nix systems</strong> <code class="ph codeph">$HOME/.puppetlabs/client-tools/puppetdb.conf</code></p></li><li class="li"><p class="p"><strong class="ph b">Windows</strong> <code class="ph codeph">%USERPROFILE%\.puppetlabs\client-tools\puppetdb.conf</code></p></li></ul><p class="p"><strong class="ph b">Note:</strong> The precedence used to load puppetdb config is:</p><ol class="ol"><li class="li"><p class="p"><code class="ph codeph">configfile</code> \(optionally specified with <code class="ph codeph">--configfile</code>\)</p></li><li class="li"><p class="p"><code class="ph codeph">$HOME/.puppetlabs/client-tools/puppetdb.conf</code></p></li><li class="li"><p class="p"><code class="ph codeph">/etc/puppetlabs/client-tools/puppetdb.conf</code> \(Windows: <code class="ph codeph">C:\ProgramData\PuppetLabs\client-tools\puppetdb.conf</code>\)</p></li></ol><p class="p"><code class="ph codeph">bolt-inventory-pdb</code> configuration can also be passed on the command line. These settings are required:</p><ul class="ul"><li class="li"><p class="p"><code class="ph codeph">--cacert</code> The path for the certification authority \(CA\) certificate.</p><p class="p">\*nix systems - /etc/puppetlabs/puppet/ssl/certs/ca.pem</p><p class="p">Windows - C:\\ProgramData\\PuppetLabs\\puppet\\etc\\ssl\\certs\\ca.pem</p></li><li class="li"><p class="p"><code class="ph codeph">--url</code> The URL of your PuppetDB server.</p></li></ul><p class="p">One of these authentication methods is required:</p><ul class="ul"><li class="li"><p class="p"><code class="ph codeph">--token-file</code> The path to the PE authorization token.</p></li><li class="li"><p class="p"><code class="ph codeph">--cert</code> and <code class="ph codeph">--key</code> The path to a client ssl certificate, and the private key for that certificate.</p></li></ul><pre class="pre codeblock"><code>$ bolt-inventory-pdb pdb.yaml -o myfile.yaml --token-file ~/mytoken --cacert /etc/puppetlabs/puppet/ssl/certs/ca.pem --url  https://&lt;PUPPETDB_HOST&gt;:8081</code></pre></div></article><article class="topic nested1" aria-labelledby="ariaid-title4" id="file-format"><h2 class="title topictitle2" id="ariaid-title4">File format</h2><div class="body"><p class="p">The <code class="ph codeph">bolt-inventory-pdb</code> tool generates an inventory file from a source yaml file. This file has the same format as the inventory file except instead of nodes keys it has query keys. The query should be a PuppetDB query in either <a class="xref" href="https://puppet.com/docs/puppetdb/latest/api/query/v4/pql.html" target="_blank">Puppet Query Language \(PQL\)</a> or <a class="xref" href="https://puppet.com/docs/puppetdb/latest/api/query/v4/ast.html" target="_blank">PuppetDB AST</a> syntax. When <code class="ph codeph">bolt-inventory-pdb</code> runs it makes queries against PuppetDB and creates a nodes item for each group. This is an example of a file that adds all nodes to the top-level group, creates a Windows group configured to use the WinRM transport and a basil group for nodes with basil in the certname.</p><pre class="pre codeblock"><code>query: "nodes[certname] {}"
groups:
  - name: windows
     query: "inventory[certname] { facts.osfamily = 'windows' }"
     config:
     transport: winrm
  - name: basil
    query: "nodes[certname] { certname ~ '^basil' }"</code></pre><p class="p"><strong class="ph b">Parent topic:</strong><a class="xref" href="inventory_file.html">Inventory file</a></p></div></article></article></main></body></html>